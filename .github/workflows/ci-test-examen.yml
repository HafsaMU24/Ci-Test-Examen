name: Workflow ci-test-examen with docker image database test

on: [push,pull_request]

jobs:
  build-with-docker:
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: ci_db
          MYSQL_PASSWORD: Mysecret@2024
        ports:
          - 3306:3306
        options: >-
          --health-cmd="mysqladmin ping -- silent"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=5

    env:
      DB_URL: jdbc:mysql://localhost:3306/ci_db
      DB_USER: root
      DB_PASSWORD: Mysecret@2024

    steps:
     - uses: actions/checkout@v4

     - name: setup java
       uses: actions/setup-java@v4
       with:
         java-version: '17'
         distribution: 'temurin'

     - name: Waite for MSQL image to be ready
       run: |
            echo "waiting for Mysql ..."
            for i in {1..30}; do
             nc -z localhost 3306 && echo " Mysql is running" && break
             sleep 2
            done

     - name: Build and test
       run: mvn clean verify





         #build-and-test:
   # runs-on: ubuntu-latest
   # steps:
     # - name: Checkout repository
       # uses: actions/checkout@v4

     # - name: set up java 17
      #  uses: actions/setup-java@v4
       # with:
              # distribution: 'temurin'
              # java-version: '17'

     # - name: Build and test with maven
      #  run: mvn clean test




